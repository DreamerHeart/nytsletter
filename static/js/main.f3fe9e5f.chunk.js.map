{"version":3,"sources":["components/styles/LoadingSpinner.module.scss","components/styles/NewsFeed.module.scss","components/styles/NewsSectionPicker.module.scss","components/styles/NewsItem.module.scss","components/NewsItem.tsx","hooks/useObserveSingleIntersection.ts","components/LoadingSpinner.tsx","components/NewsFeed.tsx","components/NewsSecionPicker.tsx","App.tsx","hooks/useVerticalScrollListener.ts","serviceWorker.ts","index.tsx"],"names":["module","exports","NewsItem","ref","this","props","aRef","className","styles","href","url","src","thumbnailStandard","alt","publishedDate","toLocaleString","title","React","PureComponent","useSingleIntersectionObserver","options","root","rootMargin","threshold","callback","elementRef","useRef","intersectionObserverCallbackRef","observer","isIntersecting","current","unobserve","observerRef","IntersectionObserver","setObservedElement","newElement","observe","useEffect","currentObserver","disconnect","LoadingSpinner","NewsFeed","apiEndpointUrl","apiKey","source","section","topMargin","useState","rawNews","setRawNews","batchOffset","isLoading","setIsLoading","isLoadingRef","undefined","loadBatch","setObservedElementRef","onRefChange","useCallback","node","length","axios","get","then","data","results","rawNewsItems","catch","err","isAxiosError","console","log","setTimeout","finally","clsx","map","item","index","thumbnail_standard","Date","published_date","uuidv4","NewsSecionPicker","mode","sections","selectedSection","setSelectedSection","s","onClick","display_name","onChange","evt","target","value","API_ENDPOINT_URL","process","API_KEY","App","newsSectionPickerMode","setNewsSectionPickerMode","document","crossedDownCallback","crossedUpCallback","lastKnownScrollPosition","ticking","listener","e","crossedDown","crossedUp","window","scrollY","requestAnimationFrame","addEventListener","removeEventListener","useVerticalScrollListener","_","setSections","encodeURIComponent","Array","from","filter","showUnder","Boolean","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","error","message"],"mappings":"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","file":"static/js/main.f3fe9e5f.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-header\":\"LoadingSpinner_App-header__ikd7M\",\"App-title\":\"LoadingSpinner_App-title__1Eqw3\",\"App-main\":\"LoadingSpinner_App-main__VEfET\",\"App-footer\":\"LoadingSpinner_App-footer__17CmQ\",\"LoadingSpinner-container\":\"LoadingSpinner_LoadingSpinner-container__2YKgK\",\"LoadingSpinner-spinner\":\"LoadingSpinner_LoadingSpinner-spinner__19YSl\",\"dotSpin\":\"LoadingSpinner_dotSpin__1gwVU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-header\":\"NewsFeed_App-header__1xBYX\",\"App-title\":\"NewsFeed_App-title__1NMF0\",\"App-main\":\"NewsFeed_App-main__1Ovgv\",\"App-footer\":\"NewsFeed_App-footer__11qlj\",\"NewsFeed\":\"NewsFeed_NewsFeed__2iwIL\",\"NewsFeed-shift\":\"NewsFeed_NewsFeed-shift__GgUbL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-header\":\"NewsSectionPicker_App-header__26r1w\",\"App-title\":\"NewsSectionPicker_App-title__2mr7D\",\"App-main\":\"NewsSectionPicker_App-main__2snmN\",\"App-footer\":\"NewsSectionPicker_App-footer__25bUh\",\"NewsSectionPicker-large\":\"NewsSectionPicker_NewsSectionPicker-large__zDPPH\",\"NewsSectionPicker-section-selected\":\"NewsSectionPicker_NewsSectionPicker-section-selected__2AD0o\",\"NewsSectionPicker-small\":\"NewsSectionPicker_NewsSectionPicker-small__1P-TA\",\"select\":\"NewsSectionPicker_select__1STrQ\",\"NewsSectionPicker-container\":\"NewsSectionPicker_NewsSectionPicker-container__1-sXA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"App-header\":\"NewsItem_App-header__3_FiB\",\"App-title\":\"NewsItem_App-title__1nK3v\",\"App-main\":\"NewsItem_App-main__2kRa-\",\"App-footer\":\"NewsItem_App-footer__2SPBf\",\"NewsItem-container\":\"NewsItem_NewsItem-container__3oTrI\",\"NewsItem-title\":\"NewsItem_NewsItem-title__3TVHT\",\"NewsItem-image\":\"NewsItem_NewsItem-image__1OVhg\",\"NewsItem-publication-datetime\":\"NewsItem_NewsItem-publication-datetime__1dRnl\",\"NewsItem-clickable\":\"NewsItem_NewsItem-clickable__3t2mI\"};","import React from \"react\";\nimport styles from \"./styles/NewsItem.module.scss\";\n\ninterface NewsItemProps {\n  aRef: ((node?: Element | null | undefined) => void) | undefined;\n  title: string;\n  url: string;\n  thumbnailStandard: string;\n  publishedDate: Date;\n}\n\n// The use of PureComponent reduces the number or unnecessary rerenders\nclass NewsItem extends React.PureComponent<NewsItemProps> {\n  render() {\n    return (\n      <article ref={this.props.aRef} className={styles[\"NewsItem-container\"]}>\n        <a className={styles[\"NewsItem-clickable\"]} href={this.props.url}>\n          <img\n            className={styles[\"NewsItem-image\"]}\n            src={this.props.thumbnailStandard}\n            alt=\"\"\n          ></img>\n          <div className={styles[\"NewsItem-text\"]}>\n            <span className={styles[\"NewsItem-publication-datetime\"]}>\n              {this.props.publishedDate.toLocaleString(\"ru-RU\")}\n            </span>{\" \"}\n            - {this.props.title}\n          </div>\n        </a>\n      </article>\n    );\n  }\n}\n\nexport default NewsItem;\n","import React, { useEffect, useRef } from \"react\";\n\ntype AfterIntersectionCallback = () => void;\n\n/**\n * React hook used to listen for an event which is emitted upon the first intersection of the target element with the root element.\n * After the intersection the observer stops tracking the target element and can be reused to observe another one.\n *\n * Usage:\n *  ```\n *  const [ setObservedElement ] = useSingleIntersectionObserver(options, callback);\n *  ```\n *\n * @param {IntersectionObserverInit} options - root, rootMargin and threshold\n * @param {() => void} callback - A callback which fires upon intersection\n * @returns {[React.MutableRefObject<(newElement: Element | null | undefined) => void>]} setObservedElement - A method, used to set the new target element. Replaces the previously tracked element.\n */\nconst useSingleIntersectionObserver = function (\n  options: IntersectionObserverInit = {\n    root: null,\n    rootMargin: \"0px\",\n    threshold: 1.0,\n  },\n  callback: AfterIntersectionCallback\n) {\n  const elementRef: React.MutableRefObject<Element | null | undefined> = useRef(\n    null\n  );\n\n  const intersectionObserverCallbackRef: React.MutableRefObject<IntersectionObserverCallback> = useRef(\n    ([entry], observer) => {\n      if (entry.isIntersecting && elementRef.current) {\n        observer.unobserve(elementRef.current);\n        elementRef.current = null;\n        callback();\n      }\n    }\n  );\n\n  const observerRef: React.MutableRefObject<IntersectionObserver> = useRef<IntersectionObserver>(\n    new IntersectionObserver(intersectionObserverCallbackRef.current, options)\n  );\n\n  const setObservedElement = useRef(\n    (newElement: Element | null | undefined) => {\n      if (elementRef.current) {\n        observerRef?.current?.unobserve(elementRef.current);\n      }\n\n      elementRef.current = newElement;\n\n      if (elementRef.current) {\n        observerRef?.current?.observe(elementRef.current);\n      }\n    }\n  );\n\n  // Disconnect observer on unmount\n  useEffect(() => {\n    const currentObserver = observerRef.current;\n    return () => {\n      currentObserver.disconnect();\n    };\n  }, []);\n\n  return [setObservedElement];\n};\n\nexport default useSingleIntersectionObserver;\n","import React from \"react\";\nimport styles from \"./styles/LoadingSpinner.module.scss\";\n\ninterface LoadingSpinnerProps {}\n\nexport const LoadingSpinner: React.FC<LoadingSpinnerProps> = () => {\n  return (\n    <div className={styles[\"LoadingSpinner-container\"]}>\n      <div className={styles[\"LoadingSpinner-spinner\"]} />\n    </div>\n  );\n};\n","import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport axios from \"axios\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport NewsItem from \"./NewsItem\";\nimport useSingleIntersectionObserver from \"../hooks/useObserveSingleIntersection\";\nimport { LoadingSpinner } from \"./LoadingSpinner\";\nimport clsx from \"clsx\";\n\nimport styles from \"./styles/NewsFeed.module.scss\";\n\ninterface NewsFeedProps {\n  apiEndpointUrl: string;\n  apiKey: string;\n  source: string;\n  section: string;\n  topMargin: \"large\" | \"small\";\n}\n\ninterface NewsItemRaw {\n  title: string;\n  url: string;\n  thumbnail_standard: string;\n  published_date: string;\n}\n\nconst batchSize = 20;\nconst maxBatchOffset = 500;\n\nexport const NewsFeed: React.FC<NewsFeedProps> = ({\n  apiEndpointUrl,\n  apiKey,\n  source,\n  section,\n  topMargin,\n}) => {\n  const [rawNews, setRawNews] = useState<NewsItemRaw[]>([]);\n\n  const batchOffset = useRef<number>(0);\n\n  // * Used to conditionally render the LoadingSpinner\n  const [isLoading, setIsLoading] = useState(false);\n\n  // * The ref is used to prevent loading an extra batch of data\n  // when the component is re-rendered after the LoadingSpinner gets mounted.\n  // Rerendering causes onRefChange callback to set observed element to the last NewsItem\n  // (the same one that already triggered the intersection event before mounting the LoadingSpinner)\n  const isLoadingRef = useRef(false);\n\n  // * Passing undefined as the first argument to use the default value of options parameter\n  const [setObservedElementRef] = useSingleIntersectionObserver(\n    undefined,\n    () => {\n      loadBatch.current();\n    }\n  );\n\n  // * Initialized to empty function, gets the real value in useEffect (see below)\n  const loadBatch = useRef(() => {});\n\n  // * Update the observed node on ref change\n  const onRefChange: (node?: Element | null) => void = useCallback(\n    (node?: Element | null) => {\n      if (rawNews.length < batchSize) return;\n      setObservedElementRef.current(node);\n    },\n    [setObservedElementRef, rawNews.length]\n  );\n\n  // * Update the observed node after every render\n  // useEffect(() => {\n  //   refToLastNewsItem.current = document.querySelector(\".NewsItem-container:last-child\");\n  //   setObservedElementRef.current(refToLastNewsItem.current);\n  // }\n\n  // When either of the deps [apiEndpointUrl, apiKey, source, section] is changed:\n  // - clear the NewsFeed and reset the offset value to 0\n  // - recreate loadBatch() function and store its ref\n  // - call loadBatch() function\n  // loadBatch() function:\n  // - returns immideately, if isLoadingRef already equals 'true' or if batchOffset.current >= maxBatchOffset\n  // - sets isLoading state and isLoadingRef to true\n  // - fetches a batch of rawNewsItems\n  // - adds the fetched data to the existing news[]\n  // - in case of HTTP error, calls loadBatch again in 10 seconds\n  // - sets isLoading state and isLoadingRef back to false\n  useEffect(() => {\n    setRawNews([]);\n    batchOffset.current = 0;\n\n    loadBatch.current = () => {\n      if (isLoadingRef.current || batchOffset.current >= maxBatchOffset) return;\n      isLoadingRef.current = true;\n      setIsLoading(true);\n      axios\n        .get(\n          `${apiEndpointUrl}/${source}/${section}.json?limit=${batchSize}&offset=${batchOffset.current}&api-key=${apiKey}`\n        )\n        .then(({ data }) => {\n          if (data.results) {\n            setRawNews((rawNewsItems) => [...rawNewsItems, ...data.results]);\n            batchOffset.current += 20;\n          } else {\n            batchOffset.current = 500;\n          }\n        })\n        .catch((err) => {\n          if (axios.isAxiosError(err)) {\n            console.log(\n              \"The API server responed with an error, retrying in 10 sec.\"\n            );\n            //TODO: limit the number of retries\n            setTimeout(loadBatch.current, 10000);\n          }\n          //TODO: alert the user, that something has gone wrong\n        })\n        .finally(() => {\n          setIsLoading(false);\n          isLoadingRef.current = false;\n        });\n    };\n\n    loadBatch.current();\n  }, [apiEndpointUrl, apiKey, source, section]);\n\n  return (\n    <section\n      className={clsx(\n        styles[\"NewsFeed\"],\n        topMargin === \"large\" && styles[\"NewsFeed-shift\"]\n      )}\n    >\n      {rawNews.map(\n        (\n          item: {\n            title: string;\n            url: string;\n            thumbnail_standard: string;\n            published_date: string;\n          },\n          index\n        ) => (\n          <NewsItem\n            aRef={index === rawNews.length - 1 ? onRefChange : undefined}\n            key={uuidv4()}\n            title={item.title}\n            url={item.url}\n            thumbnailStandard={item.thumbnail_standard}\n            publishedDate={new Date(item.published_date)}\n          />\n        )\n      )}\n\n      {isLoading && <LoadingSpinner />}\n    </section>\n  );\n};\n","import clsx from \"clsx\";\nimport React from \"react\";\nimport styles from \"./styles/NewsSectionPicker.module.scss\";\n\ninterface Section {\n  section: string;\n  display_name: string;\n}\n\ninterface NewsSecionPickerProps {\n  mode: \"small\" | \"large\";\n  sections: Section[];\n  selectedSection: string;\n  setSelectedSection: React.Dispatch<React.SetStateAction<string>>;\n}\n\nexport const NewsSecionPicker: React.FC<NewsSecionPickerProps> = ({\n  mode,\n  sections,\n  selectedSection,\n  setSelectedSection,\n}) => {\n  const handleChangeSelectedSecton = (\n    evt: React.ChangeEvent<HTMLSelectElement>\n  ) => {\n    setSelectedSection(evt.target.value);\n  };\n\n  return (\n    <nav className={styles[\"NewsSectionPicker-container\"]}>\n      {mode === \"large\" && (\n        <ul className={styles[\"NewsSectionPicker-large\"]}>\n          {sections.map((s) => (\n            <li\n              className={clsx(\n                styles[\"NewsSectionPicker-section\"],\n                selectedSection === s.section &&\n                  styles[\"NewsSectionPicker-section-selected\"]\n              )}\n              key={s.section}\n              onClick={() => {\n                setSelectedSection(s.section);\n              }}\n            >\n              {s.display_name}\n            </li>\n          ))}\n        </ul>\n      )}\n      {mode === \"large\" && (\n        <div className={styles[\"NewsSectionPicker-small\"]}>\n          <div className=\"select\">\n            <select\n              onChange={handleChangeSelectedSecton}\n              value={selectedSection}\n            >\n              {sections.map((s) => (\n                <option\n                  className={styles[\"NewsSectionPicker-section\"]}\n                  key={s.section}\n                  value={s.section}\n                >\n                  {s.display_name}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      )}\n    </nav>\n  );\n};\n","import React, { useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport ScrollToTop from \"react-scroll-up\";\n\nimport { NewsFeed } from \"./components/NewsFeed\";\nimport { NewsSecionPicker } from \"./components/NewsSecionPicker\";\nimport { useVerticalScrollListener } from \"./hooks/useVerticalScrollListener\";\n\nimport \"./styles/App.scss\";\n\nconst API_ENDPOINT_URL = process.env.REACT_APP_NYT_API_ENDPOINT_URL || \"\";\nconst API_KEY = process.env.REACT_APP_NYT_API_KEY || \"\";\nconst SOURCE = \"nyt\";\nconst DEFAULT_SECTION = \"all\";\n\nfunction App() {\n  const [newsSectionPickerMode, setNewsSectionPickerMode] = useState<\n    \"small\" | \"large\"\n  >(\"large\");\n  useVerticalScrollListener(\n    document,\n    100,\n    (_) => setNewsSectionPickerMode(\"small\" as const),\n    (_) => setNewsSectionPickerMode(\"large\" as const)\n  );\n\n  const [sections, setSections] = useState<\n    { section: string; display_name: string }[]\n  >([]);\n\n  const [selectedSection, setSelectedSection] = useState(DEFAULT_SECTION);\n\n  // On app initial load, get the section list.\n  useEffect(() => {\n    axios\n      .get(`${API_ENDPOINT_URL}/section-list.json?api-key=${API_KEY}`)\n      .then(({ data }) => {\n        let results: { section: string; display_name: string }[] = data.results;\n        results = results.map((s) => {\n          // Section names, received from the API can contain whitespaces and special characters (like '&')\n          // => escaping them with a built-in encodeURIComponent() method\n          return {\n            section: encodeURIComponent(s.section),\n            display_name: s.display_name,\n          };\n        });\n        // Add the missing \"all\" section to the resulting array and strip out the \"admin\" section\n        setSections([\n          { section: \"all\", display_name: \"All\" },\n          ...Array.from(results).filter((s) => s.section !== \"admin\"),\n        ]);\n      });\n  }, []);\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h1 className=\"App-title\">Nytsletter</h1>\n        <NewsSecionPicker\n          mode={newsSectionPickerMode}\n          sections={sections}\n          selectedSection={selectedSection}\n          setSelectedSection={setSelectedSection}\n        ></NewsSecionPicker>\n      </header>\n      <main className=\"App-main\">\n        <NewsFeed\n          apiEndpointUrl={API_ENDPOINT_URL}\n          apiKey={API_KEY}\n          source={SOURCE}\n          section={selectedSection}\n          topMargin={newsSectionPickerMode}\n        ></NewsFeed>\n      </main>\n      <footer className=\"App-footer\">\n        <ScrollToTop showUnder={160}>\n          <img\n            className=\"App-scroll-up-icon\"\n            src={process.env.PUBLIC_URL + \"/img/scroll-up-icon.png\"}\n            alt=\"Scroll up\"\n          ></img>\n        </ScrollToTop>\n        <img\n          src={process.env.PUBLIC_URL + \"/img/poweredby_nytimes_150a.png\"}\n          alt=\"Data provided by The New York Times\"\n        ></img>\n      </footer>\n    </div>\n  );\n}\n\nexport default App;\n","import { useEffect, useRef } from \"react\";\n\n/**\n * React hook used to listen for vertical scroll events.\n *\n * Usage:\n *  ```\n *  const [ lastKnownScrollPosition ]= useVerticalScrollListener(root, threshold, crossedDownCallback, crossedUpCallback);\n *  ```\n *\n * @param {Document | Element} root=document - an element to which the listener will be attached to.\n * @param {number} threshold={} - A window.scrollY threshold value upon which the callbacks are fired\n * @param {(number) => void} crossedDownCallback - A callback which fires when the threshold is crossed by scrolling downwards\n * @param {(number) => void} crossedUpCallback - A callback which fires when the threshold is crossed by scrolling upwards\n * @returns {[number]} lastKnownScrollPosition - Last known scroll position\n */\nexport const useVerticalScrollListener = (\n  root: Document | Element = document,\n  threshold: number,\n  crossedDownCallback: (position: number) => void,\n  crossedUpCallback: (position: number) => void\n) => {\n  const lastKnownScrollPosition = useRef(0);\n  const ticking = useRef(false);\n  useEffect(() => {\n    const listener: EventListenerOrEventListenerObject = function (e) {\n      let crossedDown = false;\n      let crossedUp = false;\n      if (\n        lastKnownScrollPosition.current < threshold &&\n        window.scrollY >= threshold\n      )\n        crossedDown = true;\n      if (\n        lastKnownScrollPosition.current > threshold &&\n        window.scrollY <= threshold\n      )\n        crossedUp = true;\n\n      lastKnownScrollPosition.current = window.scrollY;\n\n      if (!ticking.current) {\n        window.requestAnimationFrame(function () {\n          if (crossedDown) crossedDownCallback(lastKnownScrollPosition.current);\n          if (crossedUp) crossedUpCallback(lastKnownScrollPosition.current);\n          ticking.current = false;\n        });\n\n        ticking.current = true;\n      }\n    };\n    root.addEventListener(\"scroll\", listener);\n    return () => {\n      root.removeEventListener(\"scroll\", listener);\n    };\n  });\n  return [lastKnownScrollPosition];\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./styles/index.scss\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}